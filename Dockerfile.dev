FROM node:20-alpine

WORKDIR /app

# Install wget for healthcheck
RUN apk add --no-cache wget

# Enable corepack for pnpm
RUN corepack enable

# Copy all package files for monorepo
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages ./packages

# Install dependencies
RUN pnpm install --frozen-lockfile

# Disable ESLint in dev for faster startup
ENV NEXT_LINT_WARNONLY=true

# Copy source code
COPY . .

# Expose dev server port
EXPOSE 3000

# Default environment variables (can be overridden by docker-compose)
ENV PORT=3000
ENV HOSTNAME=0.0.0.0

# Next.js collects completely anonymous telemetry data about general usage.
ENV NEXT_TELEMETRY_DISABLED=1

# Health check (removed - using docker-compose healthcheck instead)

# Default command (overridden by docker-compose)
CMD ["pnpm", "dev", "--concurrency", "15"]